<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Grafico saldo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
        max-width: 480px;
        margin: auto;

        background-image: url('https://images.unsplash.com/photo-1602292678572-16cb94ea0d88?q=80&w=430&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        background-attachment: fixed;

        color: white;
        text-shadow: 0 0 5px black;
      }

      .spesa {
        padding: 10px;
        margin: 8px 0;
        border-bottom: 1px solid rgba(255,255,255,0.4);
      }
    </style>
  </head>
  <body>

   {% include "menu.html" %}


    <h2>Andamento del saldo del mese</h2>

    <canvas id="mioGrafico"
      style="max-width:100%; background:rgba(0,0,0,0.3); background-color: white;
             border-radius:10px; padding:15px; width:430px; height:300px;
             margin-left:2px; opacity: 0.8;">
    </canvas>

    <script>
      // Dati passati da Flask → Jinja → JS
      const labels = {{ labels | tojson }};
      const dataValues = {{ valori_saldo | tojson }};

      const ctx = document.getElementById('mioGrafico');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Saldo',
            data: dataValues,
            fill: false,
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
        }
      });
    </script>

    <h2>Ultime 5 spese</h2>

    {% for mov in ultime_cinque %}
      <div class="spesa">
        <strong>{{ "%.2f"|format(mov.amount) }} €</strong> — {{ mov.category }}<br>
        <small>{{ mov.date }}</small>
      </div>
    {% endfor %}

    {% if not ultime_cinque %}
      <p>Nessun movimento ancora registrato.</p>
    {% endif %}

    <br>

    {% if session.get('user_id') == 1 %}
    <style>
      /* cursore di default per tutta la pagina */
      * {
        cursor: url("{{ url_for('static', filename='cursor.png')}}") 0 0, default !important;
      }

      /* anche per bottoni e elementi che normalmente hanno cursore "pointer" */
      button, a, input, select, textarea, label {
        cursor: url("{{ url_for('static', filename='cursor.png')}}") 0 0, pointer !important;
      }
    </style>
    {% endif %}

  </body>
</html>
